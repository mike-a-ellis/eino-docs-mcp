---
phase: 02-document-processing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/github/client.go
  - internal/github/fetcher.go
autonomous: true

must_haves:
  truths:
    - "Fetcher can list all markdown files in cloudwego/cloudwego.github.io EINO docs directory"
    - "Fetcher can download content of individual markdown files"
    - "Fetcher respects GitHub rate limits with exponential backoff"
    - "Current repository commit SHA is retrievable"
  artifacts:
    - path: "internal/github/client.go"
      provides: "GitHub client wrapper with auth and rate limit handling"
      exports: ["NewClient", "Client"]
    - path: "internal/github/fetcher.go"
      provides: "Document fetching operations"
      exports: ["Fetcher", "FetchedDoc", "ListDocs", "FetchDoc", "GetLatestCommitSHA"]
  key_links:
    - from: "internal/github/fetcher.go"
      to: "google/go-github/v81"
      via: "API calls"
      pattern: "client\\.Repositories\\.(GetContents|ListCommits)"
---

<objective>
Implement GitHub content fetcher for EINO documentation

Purpose: Enable the indexing pipeline to fetch all markdown documentation from the cloudwego/cloudwego.github.io repository, specifically the EINO docs directory.

Output: GitHub client wrapper and fetcher that can list and download markdown files with proper rate limit handling.
</objective>

<execution_context>
@/home/bull/.claude/get-shit-done/workflows/execute-plan.md
@/home/bull/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-document-processing/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement GitHub client wrapper</name>
  <files>internal/github/client.go</files>
  <action>
Create GitHub client wrapper using google/go-github/v81:

1. Add dependencies:
   - go get github.com/google/go-github/v81/github
   - go get github.com/gofri/go-github-ratelimit/v81/github_ratelimit

2. Implement Client struct:
   - Wraps *github.Client
   - Configures with optional personal access token from GITHUB_TOKEN env var
   - Integrates go-github-ratelimit middleware for automatic rate limit handling
   - Rate limit middleware handles:
     - Primary rate limits (5000 req/hour authenticated, 60 unauthenticated)
     - Secondary rate limits (abuse detection)
     - Retry-after header respect

3. NewClient function:
   - Creates github.Client with HTTP transport
   - If GITHUB_TOKEN set, uses authenticated client
   - Wraps transport with rate limit handler
   - Returns Client struct

Key code patterns from research:
```go
import (
    "github.com/google/go-github/v81/github"
    "github.com/gofri/go-github-ratelimit/v81/github_ratelimit"
)

rateLimiter, err := github_ratelimit.NewRateLimitWaiterClient(nil)
client := github.NewClient(rateLimiter).WithAuthToken(token)
```

Do NOT hand-roll rate limit handling - use go-github-ratelimit middleware.
  </action>
  <verify>
go build ./internal/github/...
  </verify>
  <done>
Client struct created with rate limit middleware, compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement document fetcher</name>
  <files>internal/github/fetcher.go</files>
  <action>
Create Fetcher for downloading markdown documentation:

1. Define FetchedDoc struct:
   ```go
   type FetchedDoc struct {
       Path      string    // Relative path within docs directory
       Content   string    // Full markdown content
       SHA       string    // File's Git blob SHA
       URL       string    // GitHub raw URL
   }
   ```

2. Define Fetcher struct:
   - Embeds Client
   - Stores owner, repo, basePath (content/en/docs/eino)

3. NewFetcher function:
   - Takes Client, owner, repo, basePath
   - Returns configured Fetcher

4. ListDocs method:
   - Uses client.Repositories.GetContents with path to list directory
   - Recursively traverses subdirectories
   - Returns []string of all .md file paths (relative to basePath)
   - Filters to only markdown files (*.md)

5. FetchDoc method:
   - Takes file path (relative to basePath)
   - Uses client.Repositories.GetContents to get file content
   - Decodes base64 content from GitHub API response
   - Returns FetchedDoc with content, SHA, and URL

6. GetLatestCommitSHA method:
   - Uses client.Repositories.ListCommits with path filter
   - Returns SHA of most recent commit affecting the docs directory
   - Used for change detection in re-indexing

Constants:
- DefaultOwner = "cloudwego"
- DefaultRepo = "cloudwego.github.io"
- DefaultBasePath = "content/en/docs/eino"
  </action>
  <verify>
go build ./internal/github/...
go test -v ./internal/github/... -run TestFetcher 2>/dev/null || echo "Tests will be added in integration"
  </verify>
  <done>
Fetcher can list docs, fetch individual files, and get commit SHA; compiles without errors
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `go build ./...` succeeds
2. internal/github/ package exports: Client, Fetcher, FetchedDoc, NewClient, NewFetcher
3. go.mod includes google/go-github/v81 and gofri/go-github-ratelimit dependencies
</verification>

<success_criteria>
- GitHub client wrapper with rate limit handling exists
- Fetcher can list markdown files from a GitHub directory
- Fetcher can download file content with metadata
- Fetcher can retrieve latest commit SHA for change detection
- All code compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-document-processing/02-01-SUMMARY.md`
</output>
